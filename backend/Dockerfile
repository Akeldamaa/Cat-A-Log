FROM python:3.12 AS base
WORKDIR /app
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1 
RUN pip install --upgrade pip  
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .

# runs in development mode
FROM base AS dev
ENV POSTGRES_NAME=postgres
ENV POSTGRES_USER=postgres
ENV POSTGRES_PASSWORD=postgres_password
ENV POSTGRES_HOST=db
ENV DJANGO_SITE_URL=http://localhost:8000 
ENV REPLICATE_API_KEY=
ENV OPENAI_API_KEY=
ENV CLOUDINARY_CLOUD_NAME=
ENV CLOUDINARY_API_KEY=
ENV CLOUDINARY_API_SECRET=
ENV DJANGO_SECRET_KEY=
ENV DJANGO_SUPERUSER_PASSWORD=
ENV DJANGO_SUPERUSER_EMAIL=
ENV DJANGO_DEBUG=True
ENTRYPOINT ["sh", "entrypoint.sh"]

# runs in production mode
FROM base AS prod
ENV POSTGRES_NAME=
ENV POSTGRES_USER=
ENV POSTGRES_PASSWORD=
ENV POSTGRES_HOST=
ENV DJANGO_SITE_URL=
ENV REPLICATE_API_KEY=
ENV OPENAI_API_KEY=
ENV CLOUDINARY_CLOUD_NAME=
ENV CLOUDINARY_API_KEY=
ENV CLOUDINARY_API_SECRET=
ENV DJANGO_SECRET_KEY = 
ENV DJANGO_SUPERUSER_PASSWORD=
ENV DJANGO_SUPERUSER_EMAIL=
ENV DJANGO_DEBUG=False
ENTRYPOINT ["sh", "entrypoint.sh"]
